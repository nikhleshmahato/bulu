<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>nusic-nikku</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
}

/* ===== HEADER ===== */
header {
    display: flex;
    align-items: center;
    justify-content: center;
    position: sticky;
    top: 0;
    background: #1a1a1a;
    padding: 15px;
    font-size: 20px;
    font-weight: bold;
    z-index: 10;
}

#backBtn {
    position: absolute;
    left: 15px;
    background: #333;
    border: none;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    display: none; /* hidden initially */
}

/* ===== MAIN ===== */
#main {
    padding: 10px;
    padding-bottom: 120px;
}

/* Playlist Grid */
#playlist-view {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.playlist-card {
    background: #222;
    border-radius: 12px;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    cursor: pointer;
    position: relative;
}

.playlist-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.playlist-card span {
    position: absolute;
    bottom: 8px;
    left: 8px;
    font-size: 14px;
    background: rgba(0,0,0,0.6);
    padding: 4px 8px;
    border-radius: 6px;
}

/* Song View */
#song-view {
    display: none;
}

.song-item {
    padding: 15px;
    border-bottom: 1px solid #333;
    cursor: pointer;
}

.song-item:hover {
    background: #222;
}

/* ===== PLAYER ===== */
#player {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #1a1a1a;
    padding: 12px;
    box-sizing: border-box;
    display: none;
}

#songTitle {
    font-size: 14px;
    margin-bottom: 8px;
    text-align: center;
}
.progress-section {
    display: flex;
    align-items: center;
    gap: 8px;
}

.progress-section span {
    font-size: 12px;
    width: 40px;
    text-align: center;
}

#progress {
    flex: 1;
}

.controls {
    margin-top: 14px;
    display: flex;
    justify-content: space-evenly;   /* evenly spaced */
    align-items: center;
}

/* Circular Buttons */
.controls button {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    font-size: 22px;
    background: #333;
    border: none;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
}

input[type="range"] {
    flex: 1;
    margin: 0 8px;
}
</style>
</head>

<body>

<header>
    <button id="backBtn"><</button>
    <div id="headerTitle">nusic</div>
</header>

<div id="main">

    <div id="playlist-view"></div>

    <div id="song-view">
        <div id="songs-container"></div>
    </div>

</div>

<div id="player">

    <div id="songTitle">No song selected</div>

    <!-- Progress Section -->
    <div class="progress-section">
        <span id="currentTime">0:00</span>
        <input type="range" id="progress" min="0" max="100" value="0">
        <span id="duration">0:00</span>
    </div>

    <!-- Controls -->
    <div class="controls">
        <button id="prev">⏮</button>
        <button id="playPause">▶</button>
        <button id="next">⏭</button>
    </div>

</div>

<audio id="audio"></audio>

<script>
let playlists = [];
let currentPlaylist = null;
let currentSongIndex = 0;

const playlistView = document.getElementById("playlist-view");
const songView = document.getElementById("song-view");
const songsContainer = document.getElementById("songs-container");
const backBtn = document.getElementById("backBtn");
const headerTitle = document.getElementById("headerTitle");

const player = document.getElementById("player");
const audio = document.getElementById("audio");
const playPauseBtn = document.getElementById("playPause");
const progress = document.getElementById("progress");
const songTitle = document.getElementById("songTitle");
const currentTimeEl = document.getElementById("currentTime");
const durationEl = document.getElementById("duration");

/* Fetch JSON */
fetch("playlists.json")
    .then(res => res.json())
    .then(data => {
        playlists = data.playlists;
        renderPlaylists();
    });

/* Render Playlists */
function renderPlaylists() {
    playlistView.innerHTML = "";

    playlists.forEach((playlist, index) => {
        const card = document.createElement("div");
        card.className = "playlist-card";

        card.innerHTML = `
            <img src="${playlist.cover}">
            <span>${playlist.name}</span>
        `;

        card.onclick = () => {
            openPlaylist(index);
        };

        playlistView.appendChild(card);
    });
}

/* Open Playlist */
function openPlaylist(index) {
    currentPlaylist = playlists[index];

    playlistView.style.display = "none";
    songView.style.display = "block";
    backBtn.style.display = "block";

    headerTitle.textContent = currentPlaylist.name;

    songsContainer.innerHTML = "";

    currentPlaylist.songs.forEach((song, i) => {
        const div = document.createElement("div");
        div.className = "song-item";
        div.textContent = song.title;

        div.onclick = () => {
            playSong(i);
        };

        songsContainer.appendChild(div);
    });
}
function formatTime(time) {
    const minutes = Math.floor(time / 60);
    const seconds = Math.floor(time % 60)
        .toString()
        .padStart(2, "0");
    return `${minutes}:${seconds}`;
}

/* Back Button */
backBtn.onclick = () => {
    songView.style.display = "none";
    playlistView.style.display = "grid";
    backBtn.style.display = "none";
    headerTitle.textContent = "nusic-nikku";
};

/* Play Song */
function playSong(index) {
    currentSongIndex = index;
    audio.src = currentPlaylist.songs[index].file;
    audio.play();
    player.style.display = "block";
    songTitle.textContent = currentPlaylist.songs[index].title;
    playPauseBtn.textContent = "⏸";
}

/* Play / Pause */
playPauseBtn.onclick = () => {
    if (audio.paused) {
        audio.play();
        playPauseBtn.textContent = "⏸";
    } else {
        audio.pause();
        playPauseBtn.textContent = "▶";
    }
};

/* Next */
document.getElementById("next").onclick = () => {
    if (!currentPlaylist) return;
    currentSongIndex = (currentSongIndex + 1) % currentPlaylist.songs.length;
    playSong(currentSongIndex);
};

/* Previous */
document.getElementById("prev").onclick = () => {
    if (!currentPlaylist) return;
    currentSongIndex =
        (currentSongIndex - 1 + currentPlaylist.songs.length) %
        currentPlaylist.songs.length;
    playSong(currentSongIndex);
};

/* Progress */
audio.addEventListener("timeupdate", () => {
    if (!audio.duration) return;

    progress.value = (audio.currentTime / audio.duration) * 100;
    currentTimeEl.textContent = formatTime(audio.currentTime);
});
audio.addEventListener("loadedmetadata", () => {
    durationEl.textContent = formatTime(audio.duration);
});
audio.addEventListener("ended", () => {

    if (!currentPlaylist) return;

    // Move to next song
    currentSongIndex++;

    // If last song finished → restart from first
    if (currentSongIndex >= currentPlaylist.songs.length) {
        currentSongIndex = 0;
    }

    playSong(currentSongIndex);
});
progress.oninput = () => {
    if (!audio.duration) return;
    audio.currentTime = (progress.value / 100) * audio.duration;
};
</script>

</body>

</html>
